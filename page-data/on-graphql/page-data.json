{"componentChunkName":"component---src-templates-blog-post-js","path":"/on-graphql/","webpackCompilationHash":"4e1985a14b92e7367e74","result":{"data":{"site":{"siteMetadata":{"title":":heart: React","author":"Metamn"}},"markdownRemark":{"id":"00be376c-8912-5fb7-b457-6e2199f79bfe","excerpt":"Easy to use on the front-end. More complicated on the back-end.","html":"<p>Easy to use on the front-end. More complicated on the back-end.</p>\n<!--more-->\n<h2>Definition</h2>\n<p>GraphQL, according to <a href=\"https://graphql.org/learn/\">GraphQL.org</a> is three things:</p>\n<ol>\n<li>A query language</li>\n<li>A server-side runtime</li>\n<li>A type system</li>\n</ol>\n<h3>Query language</h3>\n<p>We all know query languages. SQL — to query relational databases. REST API — to query data on the backend.</p>\n<p>GraphQL is in the same way a query language. It is like REST built on the more advanced principles of <a href=\"http://metamn.io/react/is-graphql-functional-and-reactive/\">functional and reactive programming</a>.</p>\n<h3>Server-side runtime</h3>\n<p>The UNIX philosophy of</p>\n<blockquote>\n<p>Do one thing and do it well</p>\n</blockquote>\n<p><a href=\"https://www.youtube.com/watch?v=gb1R-fWP1Yw\">is built into</a> GraphQL making it a super simple layer on the server.</p>\n<p>The GraphQL runtime does only one thing: returns results for queries. How results are computed, put together, collected from other services — the business logic — is outside its scope.</p>\n<p>(As a compensation) GraphQL offers extensive connectivity to various backend services like databases, storage engines, serverless functions, authentication, caching to be used in any combination to define how the application works.</p>\n<h3>Type system</h3>\n<p>What glues together the client-side queries and server-side responses is the GraphQL Schema — a place where:</p>\n<ul>\n<li>All types are defined together with</li>\n<li>All fields for all types, and</li>\n<li>All single purpose functions (resolvers) associated with each and every field</li>\n</ul>\n<p>In practice:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* A GraphQL Schema */</span>\n\n<span class=\"token comment\">/**\n * Data type\n * - Defines a data entity\n */</span>\ntype Book <span class=\"token punctuation\">{</span>\n\tid<span class=\"token punctuation\">:</span> <span class=\"token constant\">ID</span>\n\ttitle<span class=\"token punctuation\">:</span> String  <span class=\"token comment\">/* A field */</span>\n\tauthor<span class=\"token punctuation\">:</span> Author\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Data type\n * - Defines a data entity\n */</span>\ntype Author <span class=\"token punctuation\">{</span>\n\tid<span class=\"token punctuation\">:</span> <span class=\"token constant\">ID</span>\n\tfirstName<span class=\"token punctuation\">:</span> String  <span class=\"token comment\">/* A field */</span>\n\tlastName<span class=\"token punctuation\">:</span> String\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Query type\n * - Defines operations on data\n */</span>\ntype Query <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">book</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token constant\">ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Book  <span class=\"token comment\">/* A field */</span>\n\t<span class=\"token function\">author</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token constant\">ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Author\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * Server-side, single purpose functions (resolvers)\n */</span>\n<span class=\"token keyword\">const</span> resolvers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">author</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>authors<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">:</span> id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  Author<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">books</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">author</span> <span class=\"token operator\">=></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>books<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> authorId<span class=\"token punctuation\">:</span> author<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Client-side query</span>\n<span class=\"token comment\">#</span>\nGET /graphql?query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n\tbook<span class=\"token punctuation\">(</span>id: <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\ttitle,\n\t\tauthor\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tfirstName\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * The result\n */</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Black Hole Blues\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"firstName\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Janna\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>The Facebook way</h2>\n<p>GraphQL was created by Facebook and later open sourced for the community. Together with the other parts of the stack — React, Relay — they <a href=\"https://developers.facebook.com/videos/2019/building-the-new-facebookcom-with-react-graphql-and-relay/\">power</a> one of the largest web apps today, Facebook.com.</p>\n<p>It’s good to be aware of the Facebook way. To learn about the best practices on large scale.</p>\n<blockquote>\n<p>Facebook has been using GraphQL in production for almost four years; today, it serves over 300 billion queries a day and its schema has nearly 10,000 types. </p>\n</blockquote>\n<blockquote>\n<p>In building this API, we’ve developed a set of best practices for designing an understandable and scalable GraphQL schema. — <a href=\"https://www.youtube.com/watch?v=etax3aEe2dA\">Dan Schafer at react-europe</a></p>\n</blockquote>\n<p>Facebook defines GraphQL using the following concepts:</p>\n<ol>\n<li>The underlying database and business model is a graph</li>\n<li>There is a single source of truth</li>\n<li>The API is a thin layer</li>\n</ol>\n<h3>Graph databases</h3>\n<p><a href=\"https://www.prisma.io/blog/comparison-of-database-models-1iz9u29nwn37\">Comparing Database Types: How Database Types Evolved to Meet Different Needs</a> has a great overview and definition for graph databases:</p>\n<blockquote>\n<p>Graph databases are most useful when working with data where the relationships or connections are highly important.</p>\n</blockquote>\n<p>In contrast, the relational database paradigm is best used to organize well-structured data:</p>\n<blockquote>\n<p>In general, relational databases are often a good fit for any data that is regular, predictable.</p>\n</blockquote>\n<p>In other words graph databases focus on interactions in an unpredictable environment while relational databases focus on structure in a well-known context.</p>\n<p>In graph databases entities have flexible shapes and more importantly they can form relationships freely, on the fly.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 768px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/react/static/3b80b2d015e6eb609990c6471ffb24fc/4a38b/graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.22077922077922%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+UlEQVQoz3WSiW7TQBCG8/4PAhISh0IoUFQVUKuCSkrbkCbkcprE6zg+13t4bzN2QiSsMtqVdu355p9jO1XbHGxTluWuT4IrGn6X8Q3HWfPHtVw7bVQbWCrHs8Fbb9wLvFN/fpoFfmWcNea/sHPOSg1OupQ4SRmleBen/hbO1loHWypYnDJCWRs2jBtOeBKLNJFS1uGUhiwqYyvrjjWJPCNhoDixgncOqrpiOy/w3oWrDzT+TGIEX0FHME5yDIcD6qoi+BmtT/DunEcXNQwpQbYcR5PbT6vRl9XkguRJU7/WpdC6ztaBfmPh48NseLaZX26m3xrYWCjMWGuYVAWnaUEZg5zTNBNc1e13DvSlUnt5a5zRzhjX2aenITbAUlpQk9CWUhEuccyTRbYeaxoIXLgnR2WAhFYrTYuCFSTPMqlkpat00Z8PnqFFN3p8n/ub4yv4B7ZS1pMQch+iFhdCYsZwvBz/QN4v5A2LJK3awg3sVF2tKeuSrDaaiJJwkmG4SgY1aFVKiskTsEinLL5Do6+Gjuh2rhi3LONbpHGii8z9nbCMozIO27A37HmzV2h9skM9HA4wmqFpd3b7cv27u3n4qA8TrvzR+WLwmmbZ/i0e4MndWf/qxf31m+vL58HyXlAababp1ovRPPKX0Iq9H0nDBC1U8/KO9geqFR9bU7jSjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Graph database diagram\"\n        title=\"Graph database diagram\"\n        src=\"/react/static/3b80b2d015e6eb609990c6471ffb24fc/5cc77/graph.png\"\n        srcset=\"/react/static/3b80b2d015e6eb609990c6471ffb24fc/72cd8/graph.png 192w,\n/react/static/3b80b2d015e6eb609990c6471ffb24fc/45483/graph.png 384w,\n/react/static/3b80b2d015e6eb609990c6471ffb24fc/5cc77/graph.png 768w,\n/react/static/3b80b2d015e6eb609990c6471ffb24fc/4a38b/graph.png 770w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In relational databases the business domain is well known a priori and what’s left is to create a well performing model upon.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 427px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/react/static/862b436d4275dd481798a51af65547bf/8928d/relational.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.76112412177987%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y42UC3eaSBTH+f4fotueTZomjYnR2LVqV7E+4hsVFQTkLQgiIPKShzs+au3uZjf33AMzd+Y/c8/85g60e8XiOAZfgyckoqbQLWFS0efCOX406HVxBL7SuDbpXPFEWqZSLNo5x98kVvCXKXLD4ilznhPGvbeL9+ktabyff8SahX4hKTOzN6Udgzm706TAcuMwDtbOP4egi612IKN9UvHFGlHsKkYcRVvL3o9eDP0QH2KeTG1VJNBQS2zzoxKPFj0F8RbImvy+4meeqm9VdC20Z0iBQ4uu3FnNhtD5DFS8zqJ3CyrjKCWNzQIHDXcJ24sC22+486WEZejhvYg/mWLBXxZ5pPBTrBBNYpQQmGzkd3ZBF3jktSOvE9h1cYqscY5B0yyV0aTiWqtsNHgxrV2I6War8340vsenD/IiN8buKfqJoJ5oOslj3dC08dHDCP+M4YnB8FaSv0hkBTqfvkKi3VJiWM90So9YOwsaLFIATg8LHIbGfoA1c/0/E6P686CanjQyeKsMXXIFHkV7EFEQgbZnOZ6xCcMI2HEHX7dCP9hPCAGHGDoSOtM6MDj9Ij8IXf8MZs98A5hHP1jF0J6QNpamL8wAtuXBmu17thu5VriRPJl25pSji5sl6xni1pI3DOaq3Naxj1tB6gQW8Ed6kACQfB2W0bSpGY6E61TKFPJbrSxMkkT31uBygVYOjapOfVlQxPGYIWkM09OUzOb99YtjVhfT3MawdG6MtW+IwaO1KNvLireqmRJszEuGDIuTZ4WhTmIBg0d4oj8EYDIYmRTILBA7GkURCWGe54UsNUv1B3eN5u/fK+86vRuGTKnc7CRmel9btXej7qdO7f1keNsrfdgYa1Oatsq/dWsfJ/0Hic2LdE6YZXkqu5RKCpOXafIk1gSWGnXpCbL3dp0adjzX3dqOyvHyaLpk+ZU41yXp4PJqLoG45zhHtr+UZGB7l93I217U0b8YtF/hcAFC11uTnG9aoe0Glh06rjUTPc0MADlwdS7s18fg0HflSaDXVa5IommBzHF4lkGfXaOhs7CpKH97Q36Kj4Uhj2tE95NM/uEosKuWvWXZ1yo7u6lNs0tR+B+xSjZ6jQ8klpSFr4AH0rruNa+7rSu0cWMspP8QH6qKQPrVu3ErhXef0Wby5dvHau6q/u26V/r8Wtp/ARtiXxJe+dWHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Relational database diagram\"\n        title=\"Relational database diagram\"\n        src=\"/react/static/862b436d4275dd481798a51af65547bf/8928d/relational.png\"\n        srcset=\"/react/static/862b436d4275dd481798a51af65547bf/72cd8/relational.png 192w,\n/react/static/862b436d4275dd481798a51af65547bf/45483/relational.png 384w,\n/react/static/862b436d4275dd481798a51af65547bf/8928d/relational.png 427w\"\n        sizes=\"(max-width: 427px) 100vw, 427px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>No wonder Facebook chose the graph approach. It handles better the use case of interaction-heavy user interfaces.</p>\n<h3>Domain-driven design — DDD</h3>\n<p>Dynamic contexts needs <a href=\"https://khalilstemmler.com/articles/typescript-domain-driven-design/ddd-vs-crud-design/\">a new kind of design thinking</a> to be able to provide solutions.</p>\n<p>In a rigid environment, where there are no moving parts and everything is under <em>control</em> one could easily model <em>how</em> things work using an <em>imperative</em> approach.</p>\n<p>In dynamic environments the only (relatively) sure thing is the existence of an entity. The capabilities an entity offers can change over time. Therefore the most important thing an entity can do is to <em>declare</em> <em>what</em> are its capabilities. Then the other parts of the system will be able to understand it and interact with.</p>\n<p>For such evolving models where an entity is:</p>\n<blockquote>\n<p>An object that is not defined by its attributes, but rather by a thread of continuity and its identity.</p>\n</blockquote>\n<p>a suitable design approach is called <a href=\"https://en.wikipedia.org/wiki/Domain-driven_design\">Domain-driven design</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 768px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/react/static/9b03f9f58a3d496febdabc9b0d33af9e/57e09/dddsketch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.917098445595855%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC40lEQVQoz2PwcXdmZEAFrAn+LhyKkiJCriaanDpqSgIBfr7s6fHhLCoa6hw6+vo8csrKXEB1bFDMCsSM7FxcTDADOKb3tuo+vH1t4+Mb5w6e2bkiEKiaa3lLrsy0kgQ5FQYGTqg6kAa45T5FhbyhZWW8AcXFfHqurvwgc5iYmVnBkmvnT5E7tGfbrpN7t5xbPasnBST5+fF1DpDchZOHdW5dOe+9Z+0C+/bJkyxOXrniNnHjRtfYCRPUzJqbeR2qqkRSZ8/mB9vIzMzJICUuyv3iyUOh9MQYOQaEa+Dg1sWTGz+9evL/2tFtL5Zt23z5/N17/2fv2fvOMSFRb3JHh/SOU6ckMjs6QV5nYGFl5WAoy06SuXP1/OevLx/8v7Rv3bSNq5ao37txZfGlY3tW7Fo2zTgtOUlkYmeTSXF6nK57cLB6WVu7kbm/v/yElauczt+583/fzVv/KxYtLgQZqGliwsNgaaLPt3PDSr/ta5Ykzuup1Ti4bZ3ruROHXh7fveHdvlWzvNAcDA/D2Vu38vbOmZPYPHNWWmZvrzpIjIuXF+xDdgZMAAo/AVCw3LlyZt7jO9e+3zq588KKHVv3nLpx4+38AwevW8XEqqNr4hcR5WDg4uRgVlNRFvj//z/jvEkdzOiKju/dFnf26L7p+9YtrOmbNyd348GDEzpXrGwBSnGvOXDQ/syNGxc2nT9/vGD2HGtkfWxO9jZgl54+sN3m/s0r++9eOLr/zPZlNgx4wKxNmyy3HDq0Y8qGDXtTurotUSTlZKTBUb9v8yr7M0cPHD+yfe25LQsnOoLDa1I3l7ujDbeGrg7vvnPnWUC+AYkXNzayTZ03TzwiLU0ppLSUFRpUSGHAx8uNHgkqCrIghTBxFlDSsnVxAQf+8n37wk9dv/5/1YkT//OmzwhB0WljaQ6mjQ30mNXU1Li93F1YBfn5OKE5BAWISkiA0h1LXF6ewoT584PqZszwt4+IlAfJAQARRhgPrfs4fQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DDD Sketch\"\n        title=\"DDD Sketch\"\n        src=\"/react/static/9b03f9f58a3d496febdabc9b0d33af9e/5cc77/dddsketch.png\"\n        srcset=\"/react/static/9b03f9f58a3d496febdabc9b0d33af9e/72cd8/dddsketch.png 192w,\n/react/static/9b03f9f58a3d496febdabc9b0d33af9e/45483/dddsketch.png 384w,\n/react/static/9b03f9f58a3d496febdabc9b0d33af9e/5cc77/dddsketch.png 768w,\n/react/static/9b03f9f58a3d496febdabc9b0d33af9e/57e09/dddsketch.png 772w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><em>via</em> <a href=\"https://martinfowler.com/bliki/images/boundedContext/sketch.png\">Martin Fowler</a></p>\n</blockquote>\n<h3>Microservices</h3>\n<p>The Facebook way implies Domain-driven design which is closely related to the microservices architecture.</p>\n<p>Ville Touronen from University of Helsinki wrote a well-worth-reading <a href=\"https://helda.helsinki.fi/bitstream/handle/10138/304677/Touronen_Ville_Pro_gradu_2019.pdf\">master thesis</a> about how GraphQL connects to DDD and microservices.</p>\n<p>In short — this new context, array of technologies, and paradigms requires the business domain to be split into different functional domains (<em>services</em>) which are highly isolated, independent and loosely coupled (<em>micro</em>).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 703px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/react/static/7dfd9697bf7774ccbf5bb9604449fa3e/afda5/graphql-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.76529160739687%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC6UlEQVQoz2PQ1FVm0dFTl/6v95/BSDWTAQR0DFT5NLQVuUHs////MwT6RXOYWRhrVpZMYS7Pm8MIEjcyM1QwtzRXBLEjffsYmBiEQeIqDHlJ81hTIyYrMCCBtMjpwiUZiwSQxWz1SySR+SnRXbJhAQUSMD7IYiezAlWGaU3PmAvCrslaSuzgc1LezWfAt4k7zvm0TJrPGRkuhqWc7YWXZFZPu2+wsP+557aVr/Sq085LcTMs4swOuCIfZX1FzER4I4+d3C5eD619AjXJj+TgNsY6HWWKsj/MGGZ5lAnEP7ftPpi+c+Z95ce7X/6fP3/z451bz//fvvolHiR+5MB5oLwYQ4TVCaYkj2NMziq7wUHBYK+wi9tNYy9/uN0B3jCb/bx+hgf4Iu0P8kU57uPX5TrMtWTiQ+V96184zpt02XXzyrsOc7ufyZrwH+eKdT3AH2xxgC/I7CBfnOtR3mCLg3xOKrv5GIDeRAkrVMApAiTEgRgUVqJQGhjefBLYVIfZHAa5chbn09v/BR49eLPn4YNXB25c+Br1/Pm7PXfvvNh67fyn2CdPXp26dePZmhsXP6Y+fPj8yq0bL+bcvvox+/GTl1fv3nrX+fjet5Jv335ff/b4Wx3U3E7OO/f+SP2Hgju3v7WD6L9f//y/e/d7F4j96dWXLw/ufZ8MYn949fX+44ff5oPYb559OfPy2ff1YPE3P3eDjdNgWcsX4XxIcuP8R/k7lz7J6W++br56xoOqtdMf5E9svWGxbfGT8s0LHsUtmX3f6NC6F0Xr5z0MXb3godmh9S/KVs164Ldu4UObPSsfl6+e88CNgWExJ0N38R/2SJtzYhDXVnOYiexThrBn80oyHOWEsGdwMDDsY4aw1wATvA7Ud9v5YOEnyLBGqDH/EitDoEe3RHrcAhmQYEbcPJnspCWyIHZu6jzpnJSF0iB2duJC+cyEBeCEnZ20SCktdr44RHyJSkr0DFDEMbRVXJQtSzvNBgC+5knBM+x69AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Microservices\"\n        title=\"Microservices\"\n        src=\"/react/static/7dfd9697bf7774ccbf5bb9604449fa3e/afda5/graphql-3.png\"\n        srcset=\"/react/static/7dfd9697bf7774ccbf5bb9604449fa3e/72cd8/graphql-3.png 192w,\n/react/static/7dfd9697bf7774ccbf5bb9604449fa3e/45483/graphql-3.png 384w,\n/react/static/7dfd9697bf7774ccbf5bb9604449fa3e/afda5/graphql-3.png 703w\"\n        sizes=\"(max-width: 703px) 100vw, 703px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><em>via</em> <a href=\"https://www.apollographql.com/customers/expediagroup/\">Apollo / Expedia GraphQL architecture</a></p>\n</blockquote>\n<p>Microservices complete the big picture. The Facebook way is a full bet on the <a href=\"https://blog.danlew.net/2017/07/27/an-introduction-to-functional-reactive-programming/\">Functional Reactive Programming paradigm</a> from design (DDD), data (GraphQL and graph databases), implementation (React) to servers (microservices).</p>\n<h3>Single source of truth</h3>\n<p>In a dynamic context it is very important to establish a single source of truth from where all other parts of the stack provision themselves.</p>\n<p>The creators of GraphQL <a href=\"https://www.youtube.com/watch?v=gb1R-fWP1Yw\">are always eager to emphasize</a> the importance of such a truth layer.</p>\n<p>In <a href=\"https://graphql.org/learn/thinking-in-graphs/#business-logic-layer\">Thinking in Graphs / Business Logic Layer</a> chapter there is a clear definition and a diagram describing the use case:</p>\n<blockquote>\n<p>Your business logic layer should act as the single source of truth for enforcing business domain rules</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 594px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/react/static/7a2ea703be847da2ca5545ee41c7b5ac/262c7/business-layer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.93939393939394%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADzUlEQVQ4y63Qy1NbZRgG8PNPuBBXzngZpY4zWhe0QHMBaS0Eim3CRa5hpp0BQgK0U9oilkzXVaKykNZKKCgKSQhJSEKSQpJ2IJcSkhRkXLjSHYRpgjIh5/H9ziGIrF388nzne5/3W4Tr8Uqg9UnBUueT8zqfLNcXlEPrlTTQfbIvKEPn4plct6eE13jP8dolKes3U3+D9ShzbD//BqfxSg/6nlTkvn1+I/dVRJMb8CuyOr+UHi9v6PFKE/djnRiJ6rIjEd3B/XDnQd9SOWinWeuTvdAuS4TZl5FuelSWo36Oux4sBjO0ehGfr5zH9UAxBsKl6H/ynlLnK9oajl3EvVAtvlitxHBIgYEVCXp9pxp7fUW/3aTe7WflGFypwI2nJegPngWndutG1K7er1ucXYZWZ7dB7dIZOtza0TrHA0W7+9Zwm0sz2rTQZWihWYtTY2h3935T7xiraXfd1He4daOtdMewPXrHwPVYI39seOpTCU/zNtlJeJqY7TXPZ/txt2o34VZtkx2RkuX22mLjftzTtMt6rL/uadv53VuzY3A83uEGbXP7CL6NbOAUDgSFguxyIXLRavBrKvDPL4lijcJdNvABsv53j/r7gfeB4Gv4ZVEPbsg2l4H/dfBLb/F5WGbe5LFSymNVTqR0PscjVEEp4REopPkbQo/1s0vv8PC/ws+4hnhObY1lZtx38ZNTz0879Zh26TG5MIwJB7EPwmi7g0n7HUzYBsltTDnozn6X5nq2I/R/dN7DnOsWBm3z4IpN2cxpE3B6FjxhiWYf0OAB6r1AHaXCKWYjfVcu0IxSuQicMQMfUv+jWTGLTDw4qTmTKbNkIDe/5AlLXHakUbeQhpKywZlGtS2NFncabe4MqubTaKVU0fxji9hnyojMnGEP/pWRWv6GxLTHE9A3Smb3UHxMKTk7Iyo1icnu8/18MpzUtPeS8OQgT3aCcGcWHZ2P9Y/jpJZ9yOk/ki/8Pzj5bMZMHMT+H6Y9cjxPzE72D3HrFx4ukgDxi773r1c89Mdk3/ljZWP+mJxSPiaey5kHwox1hO7RnogLV08gWfsz4rXTSJB4zTSSqhlsXbNjU23F1lUbfu2wYrPdio0Wi4DNWCd+Sdw5jgspjHsRxQTCCqOochzRK1NIdlmR6JrDRr8DSc08kt1WxK+a8UI7j80Bp9Bh3aO9Qxz9/BmuMu5SpkJV4ykhK8dTq+cfpVYvPPo3SeiTHwTsjnXyO/k9hgtXjb9KFwVhRmEsEM7VxoKocqogcmVSyChl5DL59LEgqpoqCNdMiF3aERy+8Q/stPr0eadJ8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Business logic layer\"\n        title=\"Business logic layer\"\n        src=\"/react/static/7a2ea703be847da2ca5545ee41c7b5ac/262c7/business-layer.png\"\n        srcset=\"/react/static/7a2ea703be847da2ca5545ee41c7b5ac/72cd8/business-layer.png 192w,\n/react/static/7a2ea703be847da2ca5545ee41c7b5ac/45483/business-layer.png 384w,\n/react/static/7a2ea703be847da2ca5545ee41c7b5ac/262c7/business-layer.png 594w\"\n        sizes=\"(max-width: 594px) 100vw, 594px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the Facebook approach the truth gatekeeper role is given to GraphQL. </p>\n<p>GraphQL’s type system / schema is suitable to declare and define the capabilities of an entity. And it is extendable through <em>Smart Data Objects / GraphQLObjectType</em> to connect with the business logic layer.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * From Ville Touronen's master thesis\n * \n * See: https://helda.helsinki.fi/bitstream/handle/10138/304677/Touronen_Ville_Pro_gradu_2019.pdf\n */</span>\n\n\n\n<span class=\"token comment\">/**\n * - The business logic is held in a separate layer\n * - Each type (`Book`) has an associated `model` where\n * ... data fetching, business logic, or security is solved \n * ... exactly once for this type across the application\n * ... providing the single source of truth\n * \n * See: https://blog.apollographql.com/graphql-at-facebook-by-dan-schafer-38d65ef075af \n */</span> \n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getBook <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./models/book'</span>\n\n\n<span class=\"token comment\">/**\n * Bindings to the business logic layer\n */</span>\n<span class=\"token keyword\">const</span> bookQuery <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GraphQLSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\tquery<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GraphQLObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\tname<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Query</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n\t\tfields<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\tbook<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\ttype<span class=\"token punctuation\">:</span> bookType <span class=\"token punctuation\">,</span>\n\t\t\t\targs<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tid<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\tdescription<span class=\"token punctuation\">:</span> <span class=\"token string\">'internal id of the book'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t\ttype<span class=\"token punctuation\">:</span> <span class=\"token function\">GraphQLNonNull</span> <span class=\"token punctuation\">(</span> GraphQLString <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span>\n\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token comment\">/**\n\t\t\t\t * Resolvers **always** map to the business logic\n\t\t\t\t */</span>\n\t\t\t\t<span class=\"token function-variable function\">resolve</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span> <span class=\"token parameter\">root<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getBook</span><span class=\"token punctuation\">(</span> id <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * The capabilities of an entity aka the types\n */</span>\n<span class=\"token keyword\">const</span> bookType <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GraphQLObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\tname<span class=\"token punctuation\">:</span> <span class=\"token string\">'Book'</span><span class=\"token punctuation\">,</span>\n\tdescription<span class=\"token punctuation\">:</span> <span class=\"token string\">'A book with an ISBN code'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token function-variable function\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\tid<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\ttype<span class=\"token punctuation\">:</span> <span class=\"token function\">GraphQLNonNull</span><span class=\"token punctuation\">(</span>GraphQLString<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span>\n\t\t\tdescription<span class=\"token punctuation\">:</span> <span class=\"token string\">'The internal identifier of the book'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token comment\">/* ... The other fields ... */</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/**\n * All wrapped together\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> BookSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GraphQLSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\tquery<span class=\"token punctuation\">:</span> bookQuery<span class=\"token punctuation\">,</span>\n\ttypes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> bookType <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Thin API Layer</h3>\n<p>The most important takeaway up to this point is the:</p>\n<blockquote>\n<p><code class=\"language-text\">type</code> → <code class=\"language-text\">field</code> → <code class=\"language-text\">resolver</code> → <code class=\"language-text\">business logic</code> pattern.</p>\n</blockquote>\n<p>Types have fields and every field has an associated server-side function which returns results and connects to the business logic layer.</p>\n<p>The first three items constitute the thin API layer of GraphQL, the last one is the separated business logic layer.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">|------------------|                 |----------------------|\n| GraphQL Thin API |                 | Business Logic Layer |\n|---------------------------|        |--------------------------------|\n| Type -&gt; Field -&gt; Resolver |   -&gt;   | Model / Single source of truth |\n|---------------------------|        |--------------------------------|</code></pre></div>\n<p>This pattern is a double-edged sword. It makes design and development easier but scaling on the server-side harder.</p>\n<h4>The N+1 problem</h4>\n<p>The <a href=\"https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping\">N+1 selects problem</a> is a basic design and development constraint in older paradigms like relational databases. It makes the business / data / component model to follow certain strict technical guidelines which are not natural to default human thinking.</p>\n<p>In GraphQL this issue <a href=\"https://www.youtube.com/watch?v=P_yfbQrdzJo&#x26;list=PLn2e1F9Rfr6kChXoURShhO3A-4r8FLYsO&#x26;index=18\">is automatically solved</a>.</p>\n<p>The original N+1 problem is related to database design. Improperly designed database tables can lead to more database queries than optimal reducing considerably the app response time. To circumvent this issue in the object-relational paradigm various normalization techniques are used.</p>\n<p>In GraphQL there is no N+1 problem. One can design freely the types in the schema and a middle-layer — the Dataloader — takes care of eliminating the N+1 performance issues.</p>\n<p>In practice this means <code class=\"language-text\">fields</code> can be freely added to <code class=\"language-text\">types</code> without worrying about normalization. Components can be modeled in a less rigid, more human friendly way using <em>graphs</em> which let directly store the relationships between records.</p>\n<p>Writing the associated <code class=\"language-text\">resolvers</code> to <code class=\"language-text\">fields</code> is again free thinking: just focus on the single purpose of the function of returning the results and forget about redundancy, caching and performance.</p>\n<p>The chatty server-side functions (resolvers) which might repaetedly load data from the database are collected, optimized into a single request, and their results cached — by the GraphQL middle-layer.</p>\n<h4>Challenges are mounting on the back-end</h4>\n<p>Around two third of all talks from the <a href=\"https://www.youtube.com/playlist?list=PLn2e1F9Rfr6kChXoURShhO3A-4r8FLYsO\">2019 GraphQL conference</a> is about the schema.</p>\n<p>How to build it from fragments to make it scalable; how to design it in a way to properly handle error messages; a dozen of opinions on how to manage the growth of the schema. From Github, Facebook to Twitter, Coursera and Visa everybody is facing the schema scaling issue.</p>\n<p>The GraphQL / Domain-driven design / Microservices <a href=\"https://www.youtube.com/watch?v=S22rYsesrQc&#x26;feature=youtu.be\">patterns</a> — API Gateway, Integration Database, Data Federation, Backend for Front End — are new concepts and all subject of scaling.</p>\n<h2>Conclusion</h2>\n<p>GraphQL is no silver bullet. It’s not better or worse than other paradigms.</p>\n<p>It makes app design and user interface development more human by empowering the architects, designers and front-end developers. What is gained here has to be solved on the back-end in new ways with new efforts.</p>\n<h2>Resources</h2>\n<ul>\n<li><a href=\"https://graphql.org/learn/\">Introduction to GraphQL</a></li>\n<li><a href=\"http://metamn.io/react/is-graphql-functional-and-reactive/\">Is GraphQL functional and reactive?</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=gb1R-fWP1Yw\">GraphQL before GraphQL — Dan Schafer @ GraphQLConf 2019</a></li>\n<li><a href=\"https://stackoverflow.com/questions/97197/what-is-the-n1-selects-problem-in-orm-object-relational-mapping\">The “N+1 selects problem”</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=P_yfbQrdzJo&#x26;list=PLn2e1F9Rfr6kChXoURShhO3A-4r8FLYsO&#x26;index=18\">GraphQL Execution Strategies — Andreas Marek @ GraphQL Conf 2019</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=S22rYsesrQc&#x26;feature=youtu.be\">GraphQL Berlin Meetup #15: System Design and Architecture @ GraphQL — Bogdan Nedelcu</a></li>\n<li><a href=\"https://khalilstemmler.com/articles/typescript-domain-driven-design/ddd-vs-crud-design/\">REST-first design is Imperative, DDD is Declarative [Comparison] - DDD w/ TypeScript</a></li>\n<li><a href=\"https://helda.helsinki.fi/bitstream/handle/10138/304677/Touronen_Ville_Pro_gradu_2019.pdf\">Microservice architecture patterns with GraphQL</a></li>\n<li><a href=\"https://blog.danlew.net/2017/07/27/an-introduction-to-functional-reactive-programming/\">An Introduction to Functional Reactive Programming</a></li>\n</ul>","frontmatter":{"title":"On GraphQL","date":"October 19, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/on-graphql/","previous":{"excerpt":"How joy and simplicity was brought back into our lives by the Facebook crew.","fields":{"slug":"/were-gonna-program-like-its-1999/"},"frontmatter":{"title":"We're gonna program like it's 1999"}},"next":{"excerpt":"Cory House nails it.","fields":{"slug":"/how-to-write-react-code-in2019/"},"frontmatter":{"title":"How to write React code in 2019"}}}}}